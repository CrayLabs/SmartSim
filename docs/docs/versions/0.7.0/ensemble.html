

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Ensemble &#8212; SmartSim 0.7.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom_tab_style.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ensemble';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Orchestrator" href="orchestrator.html" />
    <link rel="prev" title="Model" href="model.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">SmartSim 0.7.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="versions.html">Versions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_instructions/basic.html">Basic Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_instructions/platform.html">Installation on specific platforms</a></li>







<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="smartsim_zoo.html">Contributing Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorials/getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/online_analysis/lattice/online_analysis.html">Online Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/ml_inference/Inference-in-SmartSim.html">Online Inference</a></li>

<li class="toctree-l1"><a class="reference internal" href="tutorials/ml_training/surrogate/train_surrogate.html">Online Training</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SmartSim</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="experiment.html">Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_settings.html">Run Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_settings.html">Batch Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestrator.html">Orchestrator</a></li>
<li class="toctree-l1"><a class="reference internal" href="ss_logger.html">Logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml_features.html">ML Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="dragon.html">Dragon</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/smartsim_api.html">SmartSim API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SmartRedis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="smartredis.html">SmartRedis</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_integration.html">Integrating into a Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_python_walkthrough.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_cpp_walkthrough.html">C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_fortran_walkthrough.html">Fortran</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_data_structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_dataset_conversions.html">DataSet Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_runtime.html">Runtime Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="sr_advanced_topics.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/smartredis_api.html">SmartRedis API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SmartDashboard</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="smartdashboard.html">SmartDashboard</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/CrayLabs/SmartSim" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/CrayLabs/SmartSim/issues/new?title=Issue%20on%20page%20%2Fensemble.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ensemble.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ensemble</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization">Initialization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-expansion">Parameter Expansion</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replicas">Replicas</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manually-append">Manually Append</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#files">Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ml-models-and-scripts">ML Models and Scripts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ai-models">AI Models</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-attach-an-in-memory-ml-model">Example: Attach an In-Memory ML Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-attach-an-ml-model-from-file">Example: Attach an ML Model From File</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torchscripts">TorchScripts</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-an-in-memory-torchscript">Attach an In-Memory TorchScript</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-load-a-in-memory-torchscript-function">Example: Load a In-Memory TorchScript Function</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-a-torchscript-from-file">Attach a TorchScript From File</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-loading-a-torchscript-from-file">Example: Loading a TorchScript From File</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-torchscripts-as-raw-string">Define TorchScripts as Raw String</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-load-a-torchscript-from-string">Example: Load a TorchScript From String</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collision-prevention">Data Collision Prevention</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ensemble-functions">Ensemble Functions</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-ensemble-key-prefixing">Example: Ensemble Key Prefixing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-application-producer-script">The Application Producer Script</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-application-consumer-script">The Application Consumer Script</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-experiment-script">The Experiment Script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ensemble">
<span id="ensemble-doc"></span><h1>Ensemble<a class="headerlink" href="#ensemble" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>A SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> enables users to run a <strong>group</strong> of computational tasks together in an
<code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow. An <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is comprised of multiple <code class="docutils literal notranslate"><span class="pre">Model</span></code> objects,
where each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member (SmartSim <code class="docutils literal notranslate"><span class="pre">Model</span></code>) represents an individual application.
An <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> can be managed as a single entity and
launched with other <a class="reference internal" href="model.html#model-object-doc"><span class="std std-ref">Model’s</span></a> and <a class="reference internal" href="orchestrator.html#orch-docs"><span class="std std-ref">Orchestrators</span></a> to construct AI-enabled workflows.</p>
<p>The <a class="reference internal" href="api/smartsim_api.html#ensemble-api"><span class="std std-ref">Ensemble API</span></a> offers key features, including methods to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#attach-files-ensemble"><span class="std std-ref">Attach Configuration Files</span></a> for use at <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> runtime.</p></li>
<li><p><a class="reference internal" href="#ai-model-ensemble-doc"><span class="std std-ref">Load AI Models</span></a> (TF, TF-lite, PT, or ONNX) into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> at <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> runtime.</p></li>
<li><p><a class="reference internal" href="#ts-ensemble-doc"><span class="std std-ref">Load TorchScripts</span></a> into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> at <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> runtime.</p></li>
<li><p><a class="reference internal" href="#prefix-ensemble"><span class="std std-ref">Prevent Data Collisions</span></a> within the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, which allows for reuse of application code.</p></li>
</ul>
<p>To create a SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, use the <code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code> API function. When
initializing an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, consider one of the <strong>three</strong> creation strategies explained
in the <a class="reference internal" href="#init-ensemble-strategies"><span class="std std-ref">Initialization</span></a> section.</p>
<p>SmartSim manages <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> instances through the <a class="reference internal" href="api/smartsim_api.html#experiment-api"><span class="std std-ref">Experiment API</span></a> by providing functions to
launch, monitor, and stop applications.</p>
</section>
<section id="initialization">
<span id="init-ensemble-strategies"></span><h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading">#</a></h2>
<section id="id1">
<h3>Overview<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference internal" href="api/smartsim_api.html#experiment-api"><span class="std std-ref">Experiment API</span></a> is responsible for initializing all workflow entities.
An <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is created using the <code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code> factory method, and users can customize the
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creation via the factory method parameters.</p>
<p>The factory method arguments for <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creation can be found in the <a class="reference internal" href="api/smartsim_api.html#exp-init"><span class="std std-ref">Experiment API</span></a>
under the <code class="docutils literal notranslate"><span class="pre">create_ensemble</span></code> docstring.</p>
<p>By using specific combinations of the factory method arguments, users can tailor
the creation of an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> to align with one of the following creation strategies:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#param-expansion-init"><span class="std std-ref">Parameter Expansion</span></a>: Generate a variable-sized set of unique simulation instances
configured with user-defined input parameters.</p></li>
<li><p><a class="reference internal" href="#replicas-init"><span class="std std-ref">Replica Creation</span></a>: Generate a specified number of <code class="docutils literal notranslate"><span class="pre">Model</span></code> replicas.</p></li>
<li><p><a class="reference internal" href="#append-init"><span class="std std-ref">Manually</span></a>: Attach pre-configured <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> to manage as a single unit.</p></li>
</ol>
</section>
<section id="parameter-expansion">
<span id="param-expansion-init"></span><h3>Parameter Expansion<a class="headerlink" href="#parameter-expansion" title="Permalink to this heading">#</a></h3>
<p>Parameter expansion is a technique that allows users to set parameter values per <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member.
This is done by specifying input to the <cite>params</cite> and <cite>perm_strategy</cite> factory method arguments during
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creation (<code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code>). Users may control how the <cite>params</cite> values
are applied to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> through the <cite>perm_strategy</cite> argument. The <cite>perm_strategy</cite> argument
accepts three values listed below.</p>
<p><strong>Parameter Expansion Strategy Options:</strong></p>
<ul class="simple">
<li><p><cite>“all_perm”</cite>: Generate all possible parameter permutations for an exhaustive exploration. This
means that every possible combination of parameters will be used in the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.</p></li>
<li><p><cite>“step”</cite>: Create parameter sets by collecting identically indexed values across parameter lists.
This allows for discrete combinations of parameters for <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s.</p></li>
<li><p><cite>“random”</cite>: Enable random selection from predefined parameter spaces, offering a stochastic approach.
This means that the parameters will be chosen randomly for each <code class="docutils literal notranslate"><span class="pre">Model</span></code>, which can be useful
for exploring a wide range of possibilities.</p></li>
</ul>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h4>
<p>This subsection contains two examples of <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> parameter expansion. The
<a class="reference internal" href="#param-first-ex"><span class="std std-ref">first example</span></a> illustrates parameter expansion using two parameters
while the <a class="reference internal" href="#param-second-ex"><span class="std std-ref">second example</span></a> demonstrates parameter expansion with two
parameters along with the launch of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> as a batch workload.</p>
<p id="param-first-ex">Example 1 : Parameter Expansion Using <cite>all_perm</cite> Strategy</p>
<blockquote>
<div><p>In this example an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of four <code class="docutils literal notranslate"><span class="pre">Model</span></code> entities is created by expanding two parameters
using the <cite>all_perm</cite> strategy. All of the <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s in the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> share the same <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>
and only differ in the value of the <cite>params</cite> assigned to each member. The source code example
is available in the dropdown below for convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>

<span class="c1">#Create the parameters to expand to the Ensemble members</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Ellie&quot;</span><span class="p">,</span> <span class="s2">&quot;John&quot;</span><span class="p">],</span>
            <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
        <span class="p">}</span>

<span class="c1"># Initialize the Ensemble by specifying RunSettings, the params and &quot;all_perm&quot;</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;model_member&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">perm_strategy</span><span class="o">=</span><span class="s2">&quot;all_perm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><p>Begin by initializing a <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object to apply to
all <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a RunSettings</span>
<span class="linenos">2</span><span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, define the parameters that will be applied to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">#Create the parameters to expand to the Ensemble members</span>
<span class="linenos">2</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">3</span>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Ellie&quot;</span><span class="p">,</span> <span class="s2">&quot;John&quot;</span><span class="p">],</span>
<span class="linenos">4</span>            <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="linenos">5</span>        <span class="p">}</span>
</pre></div>
</div>
<p>Finally, initialize an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by specifying the <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>, <cite>params</cite> and <cite>perm_strategy=”all_perm”</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize the Ensemble by specifying RunSettings, the params and &quot;all_perm&quot;</span>
<span class="linenos">2</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;model_member&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">perm_strategy</span><span class="o">=</span><span class="s2">&quot;all_perm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By specifying <cite>perm_strategy=”all_perm”</cite>, all permutations of the <cite>params</cite> will
be calculated and distributed across <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. Here there are four permutations of the <cite>params</cite> values:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">1</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;Ellie&quot;</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span>
ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">2</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;Ellie&quot;</span>,<span class="w"> </span><span class="m">11</span><span class="o">]</span>
ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">3</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;John&quot;</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span>
ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">4</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;John&quot;</span>,<span class="w"> </span><span class="m">11</span><span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<p id="param-second-ex">Example 2 : Parameter Expansion Using <cite>step</cite> Strategy with the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> Configured For Batch Launching</p>
<blockquote>
<div><p>In this example an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of two <code class="docutils literal notranslate"><span class="pre">Model</span></code> entities is created by expanding two parameters
using the <cite>step</cite> strategy. All of the <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s in the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> share the same <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>
and only differ in the value of the <cite>params</cite> assigned to each member. Lastly, the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is
submitted as a batch workload. The source code example is available in the dropdown below for
convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script source code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a BatchSettings</span>
<span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;10:00:00&quot;</span><span class="p">)</span>

<span class="c1"># Initialize and configure RunSettings</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Create the parameters to expand to the Ensemble members</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Ellie&quot;</span><span class="p">,</span> <span class="s2">&quot;John&quot;</span><span class="p">],</span>
            <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
        <span class="p">}</span>

<span class="c1"># Initialize the Ensemble by specifying RunSettings, BatchSettings, the params and &quot;step&quot;</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">perm_strategy</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><p>Begin by initializing and configuring a <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code> object to
run the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a BatchSettings</span>
<span class="linenos">2</span><span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="linenos">3</span>                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;10:00:00&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code> object will instruct SmartSim to run the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> on two
nodes with a timeout of <cite>10 hours</cite>.</p>
<p>Next initialize a <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object to apply to all <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize and configure RunSettings</span>
<span class="linenos">2</span><span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">rs</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, define the parameters to include in <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">#Create the parameters to expand to the Ensemble members</span>
<span class="linenos">2</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">3</span>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Ellie&quot;</span><span class="p">,</span> <span class="s2">&quot;John&quot;</span><span class="p">],</span>
<span class="linenos">4</span>            <span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="linenos">5</span>        <span class="p">}</span>
</pre></div>
</div>
<p>Finally, initialize an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by passing in the <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>, <cite>params</cite> and <cite>perm_strategy=”step”</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize the Ensemble by specifying RunSettings, BatchSettings, the params and &quot;step&quot;</span>
<span class="linenos">2</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">perm_strategy</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When specifying <cite>perm_strategy=”step”</cite>, the <cite>params</cite> sets are created by collecting identically
indexed values across the <cite>param</cite> value lists.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">1</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;Ellie&quot;</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span>
ensemble<span class="w"> </span>member<span class="w"> </span><span class="m">2</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;John&quot;</span>,<span class="w"> </span><span class="m">11</span><span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="replicas">
<span id="replicas-init"></span><h3>Replicas<a class="headerlink" href="#replicas" title="Permalink to this heading">#</a></h3>
<p>A replica strategy involves the creation of identical <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s within an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.
This strategy is particularly useful for applications that have some inherent randomness.
Users may use the <cite>replicas</cite> factory method argument to create a specified number of identical
<code class="docutils literal notranslate"><span class="pre">Model</span></code> members during <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creation (<code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code>).</p>
<section id="id2">
<h4>Examples<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p>This subsection contains two examples of using the replicas creation strategy. The
<a class="reference internal" href="#replicas-first-ex"><span class="std std-ref">first example</span></a> illustrates creating four <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member clones
while the <a class="reference internal" href="#replicas-second-ex"><span class="std std-ref">second example</span></a> demonstrates creating four <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
member clones along with the launch of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> as a batch workload.</p>
<p id="replicas-first-ex">Example 1 : <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creation with replicas strategy</p>
<blockquote>
<div><p>In this example an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of four identical <code class="docutils literal notranslate"><span class="pre">Model</span></code> members is created by
specifying the number of clones to create via the <cite>replicas</cite> argument.
All of the <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s in the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> share the same <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>.
The source code example is available in the dropdown below for convenient execution
and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the Ensemble by specifying the number of replicas and RunSettings</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-replica&quot;</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><p>To create an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of identical <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s, begin by initializing a <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>
object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a RunSettings object</span>
<span class="linenos">2</span><span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by specifying the <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object and number of clones to <cite>replicas</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize the Ensemble by specifying the number of replicas and RunSettings</span>
<span class="linenos">2</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-replica&quot;</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span>
</pre></div>
</div>
<p>By passing in <cite>replicas=4</cite>, four identical <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members will be initialized.</p>
</div></blockquote>
<p id="replicas-second-ex">Example 2 : <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> Creation with Replicas Strategy and <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> Batch Launching</p>
<blockquote>
<div><p>In this example an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of four <code class="docutils literal notranslate"><span class="pre">Model</span></code> entities is created by specifying
the number of clones to create via the <cite>replicas</cite> argument. All of the <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s in
the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> share the same <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> and the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is
submitted as a batch workload. The source code example is available in the dropdown below for
convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a BatchSettings object</span>
<span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;10:00:00&quot;</span><span class="p">)</span>

<span class="c1"># Initialize and configure a RunSettings object</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Initialize an Ensemble</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-replica&quot;</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><p>To launch the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> of identical <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s as a batch job, begin by initializing a <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code>
object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a BatchSettings object</span>
<span class="linenos">2</span><span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="linenos">3</span>                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;10:00:00&quot;</span><span class="p">)</span>
<span class="linenos">4</span>
</pre></div>
</div>
<p>The above <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code> object will instruct SmartSim to run the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> on four
nodes with a timeout of <cite>10 hours</cite>.</p>
<p>Next, create a <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object to apply to all <code class="docutils literal notranslate"><span class="pre">Model</span></code> replicas:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize and configure a RunSettings object</span>
<span class="linenos">2</span><span class="n">rs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script.py&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">rs</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by specifying the <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object, <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code> object
and number of clones to <cite>replicas</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize an Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-replica&quot;</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">)</span>
</pre></div>
</div>
<p>By passing in <cite>replicas=4</cite>, four identical <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members will be initialized.</p>
</div></blockquote>
</section>
</section>
<section id="manually-append">
<span id="append-init"></span><h3>Manually Append<a class="headerlink" href="#manually-append" title="Permalink to this heading">#</a></h3>
<p>Manually appending <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> offers an in-depth level of customization in <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> design.
This approach is favorable when users have distinct requirements for individual <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s, such as variations
in parameters, run settings, or different types of simulations.</p>
<section id="id3">
<h4>Examples<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<p>This subsection contains an example of creating an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by manually appending <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s.
The example illustrates attaching two SmartSim <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.
The <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is submitted as a batch workload.</p>
<p>Example 1 : Append <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> and Launch as a Batch Job</p>
<blockquote>
<div><p>In this example, we append <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> for batch job execution. To do
this, we first initialize an Ensemble with a <code class="docutils literal notranslate"><span class="pre">BatchSettings</span></code> object. Then, manually
create <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s and add each to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> using the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_model</span></code> function.
The source code example is available in the dropdown below for convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize BatchSettings</span>
<span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;01:00:00&quot;</span><span class="p">)</span>

<span class="c1"># Initialize Ensemble</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-append&quot;</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">)</span>

<span class="c1"># Initialize RunSettings for Model 1</span>
<span class="n">srun_settings_1</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="n">exe</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script_1.py&quot;</span><span class="p">)</span>
<span class="c1"># Initialize RunSettings for Model 2</span>
<span class="n">srun_settings_2</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="n">exe</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script_2.py&quot;</span><span class="p">)</span>
<span class="c1"># Initialize Model 1 with RunSettings 1</span>
<span class="n">model_1</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_1&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">srun_settings_1</span><span class="p">)</span>
<span class="c1"># Initialize Model 2 with RunSettings 2</span>
<span class="n">model_2</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_2&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">srun_settings_2</span><span class="p">)</span>

<span class="c1"># Add Model member to Ensemble</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
<span class="c1"># Add Model member to Ensemble</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><p>To create an empty <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> to append <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s, initialize the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> with
a batch settings object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize BatchSettings</span>
<span class="linenos">2</span><span class="n">bs</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_batch_settings</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="linenos">3</span>                               <span class="n">time</span><span class="o">=</span><span class="s2">&quot;01:00:00&quot;</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="c1"># Initialize Ensemble</span>
<span class="linenos">6</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble-append&quot;</span><span class="p">,</span> <span class="n">batch_settings</span><span class="o">=</span><span class="n">bs</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, create the <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s to append to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize RunSettings for Model 1</span>
<span class="linenos">2</span><span class="n">srun_settings_1</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="n">exe</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script_1.py&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="c1"># Initialize RunSettings for Model 2</span>
<span class="linenos">4</span><span class="n">srun_settings_2</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="n">exe</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;path/to/application_script_2.py&quot;</span><span class="p">)</span>
<span class="linenos">5</span><span class="c1"># Initialize Model 1 with RunSettings 1</span>
<span class="linenos">6</span><span class="n">model_1</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_1&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">srun_settings_1</span><span class="p">)</span>
<span class="linenos">7</span><span class="c1"># Initialize Model 2 with RunSettings 2</span>
<span class="linenos">8</span><span class="n">model_2</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_2&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">srun_settings_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, append the <code class="docutils literal notranslate"><span class="pre">Model</span></code> objects to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Add Model member to Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
<span class="linenos">3</span><span class="c1"># Add Model member to Ensemble</span>
<span class="linenos">4</span><span class="n">ensemble</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span>
</pre></div>
</div>
<p>The new <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is comprised of two appended <code class="docutils literal notranslate"><span class="pre">Model</span></code> members.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="files">
<span id="attach-files-ensemble"></span><h2>Files<a class="headerlink" href="#files" title="Permalink to this heading">#</a></h2>
<section id="id4">
<h3>Overview<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members often depend on external files (e.g. training datasets, evaluation datasets, etc)
to operate as intended. Users can instruct SmartSim to copy, symlink, or manipulate external files
prior to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> launch via the <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> function. Attached files
will be applied to all <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple calls to <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> will overwrite previous file configurations
on the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.</p>
</div>
<p>To attach a file to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> for use at runtime, provide one of the following arguments to the
<code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> function:</p>
<ul class="simple">
<li><p><cite>to_copy</cite> (t.Optional[t.List[str]] = None): Files that are copied into the path of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members.</p></li>
<li><p><cite>to_symlink</cite> (t.Optional[t.List[str]] = None): Files that are symlinked into the path of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members.
A symlink, or symbolic link, is a file that points to another file or directory, allowing you to access that file
as if it were located in the same directory as the symlink.</p></li>
</ul>
<p>To specify a template file in order to programmatically replace specified parameters during generation
of <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member directories, pass the following value to the <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> function:</p>
<ul class="simple">
<li><p><cite>to_configure</cite> (t.Optional[t.List[str]] = None): This parameter is designed for text-based <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
member input files. During directory generation for <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members, the linked files are parsed and replaced with
the <cite>params</cite> values applied to each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member. To further explain, the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
creation strategy is considered when replacing the tagged parameters in the input files.
These tagged parameters are placeholders in the text that are replaced with the actual
parameter values during the directory generation process. The default tag is a semicolon
(e.g., THERMO = ;THERMO;).</p></li>
</ul>
<p>In the <a class="reference internal" href="#files-example-doc-ensem"><span class="std std-ref">Example</span></a> subsection, we provide an example using the value <cite>to_configure</cite>
within <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>To add a file to a single <code class="docutils literal notranslate"><span class="pre">Model</span></code> that will be appended to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, refer to the <a class="reference internal" href="model.html#files-doc"><span class="std std-ref">Files</span></a>
section of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> documentation.</p>
</div>
</section>
<section id="example">
<span id="files-example-doc-ensem"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h3>
<p>This example demonstrates how to attach a text file to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> for parameter replacement.
This is accomplished using the <cite>params</cite> function parameter in
the <code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code> factory function and the <cite>to_configure</cite> function parameter
in <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code>. The source code example is available in the dropdown below for
convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Example Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;/path/to/application.py&quot;</span><span class="p">)</span>

<span class="c1"># Initialize an Ensemble object via replicas strategy</span>
<span class="n">example_ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;THERMO&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Attach the file to the Ensemble instance</span>
<span class="n">example_ensemble</span><span class="o">.</span><span class="n">attach_generator_files</span><span class="p">(</span><span class="n">to_configure</span><span class="o">=</span><span class="s2">&quot;path/to/params_inputs.txt&quot;</span><span class="p">)</span>

<span class="c1"># Generate the Ensemble directory</span>
<span class="n">exp</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">example_ensemble</span><span class="p">)</span>

<span class="c1"># Launch the Ensemble</span>
<span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">example_ensemble</span><span class="p">)</span>

</pre></div>
</div>
</div>
</details><p>In this example, we have a text file named <cite>params_inputs.txt</cite>. Within the text, is the parameter <cite>THERMO</cite>
that is required by each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member at runtime:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">THERMO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">;</span>THERMO<span class="p">;</span>
</pre></div>
</div>
<p>In order to have the tagged parameter <cite>;THERMO;</cite> replaced with a usable value at runtime, two steps are required:</p>
<ol class="arabic simple">
<li><p>The <cite>THERMO</cite> variable must be included in <code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code> factory method as
part of the <cite>params</cite> parameter.</p></li>
<li><p>The file containing the tagged parameter <cite>;THERMO;</cite>, <cite>params_inputs.txt</cite>, must be attached to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
via the <code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> method as part of the <cite>to_configure</cite> parameter.</p></li>
</ol>
<p>To encapsulate our application within an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, we must create an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> instance
to gain access to the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> factory method that creates the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.
Begin by importing the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> module and initializing an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># Initialize the Experiment</span>
<span class="linenos">4</span><span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To create our <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, we are using the <cite>replicas</cite> initialization strategy.
Begin by creating a simple <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code> object to specify the path to
the executable simulation as an executable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a RunSettings object</span>
<span class="linenos">2</span><span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">exe_args</span><span class="o">=</span><span class="s2">&quot;/path/to/application.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, initialize an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> object with <code class="docutils literal notranslate"><span class="pre">Experiment.create_ensemble</span></code>
by passing in <cite>ensemble_settings</cite>, <cite>params={“THERMO”:1}</cite> and <cite>replicas=2</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize an Ensemble object via replicas strategy</span>
<span class="linenos">2</span><span class="n">example_ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;THERMO&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p>We now have an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> instance named <cite>example_ensemble</cite>. Attach the above text file
to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> for use at entity runtime. To do so, we use the
<code class="docutils literal notranslate"><span class="pre">Ensemble.attach_generator_files</span></code> function and specify the <cite>to_configure</cite>
parameter with the path to the text file, <cite>params_inputs.txt</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Attach the file to the Ensemble instance</span>
<span class="linenos">2</span><span class="n">example_ensemble</span><span class="o">.</span><span class="n">attach_generator_files</span><span class="p">(</span><span class="n">to_configure</span><span class="o">=</span><span class="s2">&quot;path/to/params_inputs.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To create an isolated directory for the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member outputs and configuration files, invoke <code class="docutils literal notranslate"><span class="pre">Experiment.generate</span></code> via the
<code class="docutils literal notranslate"><span class="pre">Experiment</span></code> instance <cite>exp</cite> with <cite>example_ensemble</cite> as an input parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Generate the Ensemble directory</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">example_ensemble</span><span class="p">)</span>
</pre></div>
</div>
<p>After invoking <code class="docutils literal notranslate"><span class="pre">Experiment.generate</span></code>, the attached generator files will be available for the
application when <code class="docutils literal notranslate"><span class="pre">exp.start(example_ensemble)</span></code> is called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Launch the Ensemble</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">example_ensemble</span><span class="p">)</span>
</pre></div>
</div>
<p>The contents of <cite>params_inputs.txt</cite> after <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> completion are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">THERMO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</section>
</section>
<section id="ml-models-and-scripts">
<span id="ensemble-ml-model-script"></span><h2>ML Models and Scripts<a class="headerlink" href="#ml-models-and-scripts" title="Permalink to this heading">#</a></h2>
<section id="id5">
<h3>Overview<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>SmartSim users have the capability to load ML models and TorchScripts into an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>
within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> script for use within <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. Functions
accessible through an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> object support loading ML models (TensorFlow, TensorFlow-lite,
PyTorch, and ONNX) and TorchScripts into standalone or colocated <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code> before
application runtime.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>To add an ML model or TorchScript to a single <code class="docutils literal notranslate"><span class="pre">Model</span></code> that will be appended to an
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, refer to the <a class="reference internal" href="model.html#ml-script-model-doc"><span class="std std-ref">ML Models and Scripts</span></a>
section of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> documentation.</p>
</div>
<p>Depending on the planned storage method of the <strong>ML model</strong>, there are <strong>two</strong> distinct
approaches to load it into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#in-mem-ml-model-ensemble-ex"><span class="std std-ref">From Memory</span></a></p></li>
<li><p><a class="reference internal" href="#from-file-ml-model-ensemble-ex"><span class="std std-ref">From File</span></a></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Uploading an ML model <a class="reference internal" href="#in-mem-ml-model-ensemble-ex"><span class="std std-ref">from memory</span></a> is solely supported for
standalone <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>. To upload an ML model to a colocated <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, users
must save the ML model to disk and upload <a class="reference internal" href="#from-file-ml-model-ensemble-ex"><span class="std std-ref">from file</span></a>.</p>
</div>
<p>Depending on the planned storage method of the <strong>TorchScript</strong>, there are <strong>three</strong> distinct
approaches to load it into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#in-mem-tf-ensemble-doc"><span class="std std-ref">From Memory</span></a></p></li>
<li><p><a class="reference internal" href="#ts-from-file-ensemble"><span class="std std-ref">From File</span></a></p></li>
<li><p><a class="reference internal" href="#ts-raw-string-ensemble"><span class="std std-ref">From String</span></a></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Uploading a TorchScript <a class="reference internal" href="#in-mem-tf-ensemble-doc"><span class="std std-ref">from memory</span></a> is solely supported for
standalone <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>. To upload a TorchScript to a colocated <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, users
upload <a class="reference internal" href="#ts-from-file-ensemble"><span class="std std-ref">from file</span></a> or <a class="reference internal" href="#ts-raw-string-ensemble"><span class="std std-ref">from string</span></a>.</p>
</div>
<p>Once a ML model or TorchScript is loaded into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members can
leverage ML capabilities by utilizing the SmartSim client (<a class="reference internal" href="api/smartredis_api.html#smartredis-api"><span class="std std-ref">SmartRedis</span></a>)
to execute the stored ML models or TorchScripts.</p>
</section>
<section id="ai-models">
<span id="ai-model-ensemble-doc"></span><h3>AI Models<a class="headerlink" href="#ai-models" title="Permalink to this heading">#</a></h3>
<p>When configuring an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, users can instruct SmartSim to load
Machine Learning (ML) models dynamically to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> (colocated or standalone). ML models added
are loaded into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> prior to the execution of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>. To load an ML model
to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, SmartSim users can serialize and provide the ML model <strong>in-memory</strong> or specify the <strong>file path</strong>
via the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_ml_model</span></code> function. The supported ML frameworks are TensorFlow,
TensorFlow-lite, PyTorch, and ONNX.</p>
<p>Users must <strong>serialize TensorFlow ML models</strong> before sending to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> from memory
or from file. To save a TensorFlow model to memory, SmartSim offers the <code class="docutils literal notranslate"><span class="pre">serialize_model</span></code>
function. This function returns the TF model as a byte string with the names of the
input and output layers, which will be required upon uploading. To save a TF model to disk,
SmartSim offers the <code class="docutils literal notranslate"><span class="pre">freeze_model</span></code> function which returns the path to the serialized
TF model file with the names of the input and output layers. Additional TF model serialization
information and examples can be found in the <a class="reference internal" href="ml_features.html#ml-features-docs"><span class="std std-ref">ML Features</span></a> section of SmartSim.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Uploading an ML model from memory is only supported for standalone <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>.</p>
</div>
<p>When attaching an ML model using <code class="docutils literal notranslate"><span class="pre">Ensemble.add_ml_model</span></code>, the
following arguments are offered to customize storage and execution:</p>
<ul class="simple">
<li><p><cite>name</cite> (str): name to reference the ML model in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>backend</cite> (str): name of the backend (TORCH, TF, TFLITE, ONNX).</p></li>
<li><p><cite>model</cite> (t.Optional[str] = None): An ML model in memory (only supported for non-colocated <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>).</p></li>
<li><p><cite>model_path</cite> (t.Optional[str] = None): serialized ML model.</p></li>
<li><p><cite>device</cite> (t.Literal[“CPU”, “GPU”] = “CPU”): name of device for execution, defaults to “CPU”.</p></li>
<li><p><cite>devices_per_node</cite> (int = 1): The number of GPU devices available on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
<li><p><cite>first_device</cite> (int = 0): The first GPU device to use on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
<li><p><cite>batch_size</cite> (int = 0): batch size for execution, defaults to 0.</p></li>
<li><p><cite>min_batch_size</cite> (int = 0): minimum batch size for ML model execution, defaults to 0.</p></li>
<li><p><cite>min_batch_timeout</cite> (int = 0): time to wait for minimum batch size, defaults to 0.</p></li>
<li><p><cite>tag</cite> (str = “”): additional tag for ML model information, defaults to “”.</p></li>
<li><p><cite>inputs</cite> (t.Optional[t.List[str]] = None): ML model inputs (TF only), defaults to None.</p></li>
<li><p><cite>outputs</cite> (t.Optional[t.List[str]] = None): ML model outputs (TF only), defaults to None.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>To add an ML model to a single <code class="docutils literal notranslate"><span class="pre">Model</span></code> that will be appended to an
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, refer to the <a class="reference internal" href="model.html#ai-model-doc"><span class="std std-ref">AI Models</span></a>
section of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> documentation.</p>
</div>
<section id="example-attach-an-in-memory-ml-model">
<span id="in-mem-ml-model-ensemble-ex"></span><h4>Example: Attach an In-Memory ML Model<a class="headerlink" href="#example-attach-an-in-memory-ml-model" title="Permalink to this heading">#</a></h4>
<p>This example demonstrates how to attach an in-memory ML model to a SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
to load into an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> at <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> runtime. The source code example is
available in the dropdown below for convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">Input</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">create_tf_cnn</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an in-memory Keras CNN for example purposes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">smartsim.ml.tf</span> <span class="kn">import</span> <span class="n">serialize_model</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
        <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">n</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">serialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Serialize and save TF model</span>
<span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">create_tf_cnn</span><span class="p">()</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a Model object</span>
<span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>

<span class="c1"># Attach the in-memory ML model to the SmartSim Ensemble</span>
<span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_ml_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;TF&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example assumes:</p>
<ul class="simple">
<li><p>an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is launched prior to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> execution</p></li>
<li><p>an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow</p></li>
<li><p>a Tensorflow-based ML model was serialized using <code class="docutils literal notranslate"><span class="pre">serialize_model</span></code> which returns the
ML model as a byte string with the names of the input and output layers</p></li>
</ul>
</div>
<p><strong>Attach the ML Model to a SmartSim Ensemble</strong></p>
<p>In this example, we have a serialized Tensorflow-based ML model that was saved to a byte string stored under <cite>model</cite>.
Additionally, the <code class="docutils literal notranslate"><span class="pre">serialize_model</span></code> function returned the names of the input and output layers stored under
<cite>inputs</cite> and <cite>outputs</cite>. Assuming an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists, we add the byte string TensorFlow model using
<code class="docutils literal notranslate"><span class="pre">Ensemble.add_ml_model</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Attach the in-memory ML model to the SmartSim Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_ml_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;TF&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">ensemble_instance.add_ml_model</span></code> code snippet, we offer the following arguments:</p>
<ul class="simple">
<li><p><cite>name</cite> (“cnn”): A name to reference the ML model in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>backend</cite> (“TF”): Indicating that the ML model is a TensorFlow model.</p></li>
<li><p><cite>model</cite> (model): The in-memory representation of the TensorFlow model.</p></li>
<li><p><cite>device</cite> (“GPU”): Specifying the device for ML model execution.</p></li>
<li><p><cite>devices_per_node</cite> (2): Use two GPUs per node.</p></li>
<li><p><cite>first_device</cite> (0): Start with 0 index GPU.</p></li>
<li><p><cite>inputs</cite> (inputs): The name of the ML model input nodes (TensorFlow only).</p></li>
<li><p><cite>outputs</cite> (outputs): The name of the ML model output nodes (TensorFlow only).</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calling <cite>exp.start(ensemble_instance)</cite> prior to the launch of an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> will result in
a failed attempt to load the ML model to a non-existent standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is started via <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code>, the ML model will be loaded to the
launched standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The ML model can then be executed on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> via a SmartSim
client (<a class="reference internal" href="api/smartredis_api.html#smartredis-api"><span class="std std-ref">SmartRedis</span></a>) within the application code.</p>
</section>
<section id="example-attach-an-ml-model-from-file">
<span id="from-file-ml-model-ensemble-ex"></span><h4>Example: Attach an ML Model From File<a class="headerlink" href="#example-attach-an-ml-model-from-file" title="Permalink to this heading">#</a></h4>
<p>This example demonstrates how to attach a ML model from file to a SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
to load into an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> at <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> runtime. The source code example is
available in the dropdown below for convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">Input</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">save_tf_cnn</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Keras CNN and save to file for example purposes&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">smartsim.ml.tf</span> <span class="kn">import</span> <span class="n">freeze_model</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">input_shape</span><span class="p">))</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">n</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">freeze_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a Model object</span>
<span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>

<span class="c1"># Serialize and save TF model to file</span>
<span class="n">model_file</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">save_tf_cnn</span><span class="p">(</span><span class="n">ensemble_instance</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;model.pb&quot;</span><span class="p">)</span>

<span class="c1"># Attach ML model file to Ensemble</span>
<span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_ml_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;TF&quot;</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">model_file</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example assumes:</p>
<ul class="simple">
<li><p>a standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is launched prior to <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> execution</p></li>
<li><p>an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow</p></li>
<li><p>a Tensorflow-based ML model was serialized using <code class="docutils literal notranslate"><span class="pre">freeze_model</span></code> which returns the
the path to the serialized model file and the names of the input and output layers</p></li>
</ul>
</div>
<p><strong>Attach the ML Model to a SmartSim Ensemble</strong></p>
<p>In this example, we have a serialized Tensorflow-based ML model that was saved to disk and stored under <cite>model</cite>.
Additionally, the <code class="docutils literal notranslate"><span class="pre">freeze_model</span></code> function returned the names of the input and output layers stored under
<cite>inputs</cite> and <cite>outputs</cite>. Assuming an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists, we add a TensorFlow model using
the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_ml_model</span></code> function and specify the ML model path to the parameter <cite>model_path</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Attach ML model file to Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_ml_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;TF&quot;</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">model_file</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">ensemble_instance.add_ml_model</span></code> code snippet, we offer the following arguments:</p>
<ul class="simple">
<li><p><cite>name</cite> (“cnn”): A name to reference the ML model in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>backend</cite> (“TF”): Indicating that the ML model is a TensorFlow model.</p></li>
<li><p><cite>model_path</cite> (model_file): The path to the ML model script.</p></li>
<li><p><cite>device</cite> (“GPU”): Specifying the device for ML model execution.</p></li>
<li><p><cite>devices_per_node</cite> (2): Use two GPUs per node.</p></li>
<li><p><cite>first_device</cite> (0): Start with 0 index GPU.</p></li>
<li><p><cite>inputs</cite> (inputs): The name of the ML model input nodes (TensorFlow only).</p></li>
<li><p><cite>outputs</cite> (outputs): The name of the ML model output nodes (TensorFlow only).</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calling <cite>exp.start(ensemble_instance)</cite> prior to instantiation of an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> will result in
a failed attempt to load the ML model to a non-existent <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is started via <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code>, the ML model will be loaded to the
launched <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The ML model can then be executed on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> via a SmartSim
client (<a class="reference internal" href="api/smartredis_api.html#smartredis-api"><span class="std std-ref">SmartRedis</span></a>) within the application executable.</p>
</section>
</section>
<section id="torchscripts">
<span id="ts-ensemble-doc"></span><h3>TorchScripts<a class="headerlink" href="#torchscripts" title="Permalink to this heading">#</a></h3>
<p>When configuring an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, users can instruct SmartSim to load TorchScripts dynamically
to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The TorchScripts become available for each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member upon being loaded
into the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> prior to the execution of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>. SmartSim users may upload
a single TorchScript function via <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code> or alternatively upload a script
containing multiple functions via <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code>. To load a TorchScript to the
<code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, SmartSim users can follow one of the following processes:</p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="model.html#in-mem-tf-doc"><span class="std std-ref">Define a TorchScript Function In-Memory</span></a></dt><dd><p>Use the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code> to instruct SmartSim to load an in-memory TorchScript to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="model.html#ts-from-file"><span class="std std-ref">Define Multiple TorchScript Functions From File</span></a></dt><dd><p>Provide file path to <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> to instruct SmartSim to load the TorchScript from file to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="model.html#ts-raw-string"><span class="std std-ref">Define a TorchScript Function as String</span></a></dt><dd><p>Provide function string to <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> to instruct SmartSim to load a raw string as a TorchScript function to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Uploading a TorchScript <a class="reference internal" href="model.html#in-mem-tf-doc"><span class="std std-ref">from memory</span></a> using <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code>
is only supported for standalone <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>. Users uploading
TorchScripts to colocated <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code> should instead use the function <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code>
to upload <a class="reference internal" href="model.html#ts-from-file"><span class="std std-ref">from file</span></a> or as a <a class="reference internal" href="model.html#ts-raw-string"><span class="std std-ref">string</span></a>.</p>
</div>
<p>Each function also provides flexible device selection, allowing users to choose between which device the TorchScript is executed on, <cite>“GPU”</cite> or <cite>“CPU”</cite>.
In environments with multiple devices, specific device numbers can be specified using the
<cite>devices_per_node</cite> parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <cite>device=GPU</cite> is specified when attaching a TorchScript function to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, this instructs
SmartSim to execute the TorchScript on GPU nodes. However, TorchScripts loaded to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> are
executed on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> compute resources. Therefore, users must make sure that the device
specified is included in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> compute resources. To further explain, if a user
specifies <cite>device=GPU</cite>, however, initializes <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> on only CPU nodes,
the TorchScript will not run on GPU nodes as advised.</p>
</div>
<p>Continue or select the respective process link to learn more on how each function (<code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> and <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code>)
dynamically loads TorchScripts to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>To add a TorchScript to a single <code class="docutils literal notranslate"><span class="pre">Model</span></code> that will be appended to an
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, refer to the <a class="reference internal" href="model.html#ts-doc"><span class="std std-ref">TorchScripts</span></a>
section of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> documentation.</p>
</div>
<section id="attach-an-in-memory-torchscript">
<span id="in-mem-tf-ensemble-doc"></span><h4>Attach an In-Memory TorchScript<a class="headerlink" href="#attach-an-in-memory-torchscript" title="Permalink to this heading">#</a></h4>
<p>Users can define TorchScript functions within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script
to attach to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>. This feature is supported by <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code> does <strong>not</strong> support loading in-memory TorchScript functions to a colocated <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.
If you would like to load a TorchScript function to a colocated <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, define the function
as a <a class="reference internal" href="#ts-raw-string-ensemble"><span class="std std-ref">raw string</span></a> or <a class="reference internal" href="#ts-from-file-ensemble"><span class="std std-ref">load from file</span></a>.</p>
</div>
<p>When specifying an in-memory TF function using <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code>, the
following arguments are offered:</p>
<ul class="simple">
<li><p><cite>name</cite> (str): reference name for the script inside of the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>function</cite> (t.Optional[str] = None): TorchScript function code.</p></li>
<li><p><cite>device</cite> (t.Literal[“CPU”, “GPU”] = “CPU”): device for script execution, defaults to “CPU”.</p></li>
<li><p><cite>devices_per_node</cite> (int = 1): The number of GPU devices available on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
<li><p><cite>first_device</cite> (int = 0): The first GPU device to use on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
</ul>
<section id="example-load-a-in-memory-torchscript-function">
<span id="in-mem-tf-ex"></span><h5>Example: Load a In-Memory TorchScript Function<a class="headerlink" href="#example-load-a-in-memory-torchscript-function" title="Permalink to this heading">#</a></h5>
<p>This example walks through the steps of instructing SmartSim to load an in-memory TorchScript function
to a standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The source code example is available in the dropdown below for
convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="k">def</span> <span class="nf">timestwo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a Ensemble object</span>
<span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>

<span class="c1"># Attach TorchScript to Ensemble</span>
<span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_func&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">timestwo</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example assumes:</p>
<ul class="simple">
<li><p>a standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is launched prior to <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> execution</p></li>
<li><p>an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow</p></li>
</ul>
</div>
<p><strong>Define an In-Memory TF Function</strong></p>
<p>To begin, define an in-memory TorchScript function within the Python driver script.
For the purpose of the example, we add a simple TorchScript function, <cite>timestwo</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">timestwo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
<p><strong>Attach the In-Memory TorchScript Function to a SmartSim Ensemble</strong></p>
<p>We use the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_function</span></code> function to instruct SmartSim to load the TorchScript function <cite>timestwo</cite>
onto the launched standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. Specify the function <cite>timestwo</cite> to the <cite>function</cite>
parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Attach TorchScript to Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_func&quot;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">timestwo</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">ensemble_instance.add_function</span></code> code snippet, we offer the following arguments:</p>
<ul class="simple">
<li><p><cite>name</cite> (“example_func”): A name to uniquely identify the TorchScript within the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>function</cite> (timestwo): Name of the TorchScript function defined in the Python driver script.</p></li>
<li><p><cite>device</cite> (“GPU”): Specifying the device for TorchScript execution.</p></li>
<li><p><cite>devices_per_node</cite> (2): Use two GPUs per node.</p></li>
<li><p><cite>first_device</cite> (0): Start with 0 index GPU.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calling <cite>exp.start(ensemble_instance)</cite> prior to instantiation of an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> will result in
a failed attempt to load the TorchScript to a non-existent <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is started via <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code>, the TF function will be loaded to the
standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The function can then be executed on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> via a SmartSim
client (<a class="reference internal" href="api/smartredis_api.html#smartredis-api"><span class="std std-ref">SmartRedis</span></a>) within the application code.</p>
</section>
</section>
<section id="attach-a-torchscript-from-file">
<span id="ts-from-file-ensemble"></span><h4>Attach a TorchScript From File<a class="headerlink" href="#attach-a-torchscript-from-file" title="Permalink to this heading">#</a></h4>
<p>Users can attach TorchScript functions from a file to an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> and upload them to a
colocated or standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. This functionality is supported by the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code>
function’s <cite>script_path</cite> parameter.</p>
<p>When specifying a TorchScript using <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code>, the
following arguments are offered:</p>
<ul class="simple">
<li><p><cite>name</cite> (str): Reference name for the script inside of the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>script</cite> (t.Optional[str] = None): TorchScript code (only supported for non-colocated <code class="docutils literal notranslate"><span class="pre">Orchestrators</span></code>).</p></li>
<li><p><cite>script_path</cite> (t.Optional[str] = None): path to TorchScript code.</p></li>
<li><p><cite>device</cite> (t.Literal[“CPU”, “GPU”] = “CPU”): device for script execution, defaults to “CPU”.</p></li>
<li><p><cite>devices_per_node</cite> (int = 1): The number of GPU devices available on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
<li><p><cite>first_device</cite> (int = 0): The first GPU device to use on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
</ul>
<section id="example-loading-a-torchscript-from-file">
<h5>Example: Loading a TorchScript From File<a class="headerlink" href="#example-loading-a-torchscript-from-file" title="Permalink to this heading">#</a></h5>
<p>This example walks through the steps of instructing SmartSim to load a TorchScript from file
to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. The source code example is available in the dropdown below for
convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/example_simulation_program&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a Model object</span>
<span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>

<span class="c1"># Attach TorchScript to Ensemble</span>
<span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_script</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_script&quot;</span><span class="p">,</span> <span class="n">script_path</span><span class="o">=</span><span class="s2">&quot;path/to/torchscript.py&quot;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example assumes:</p>
<ul class="simple">
<li><p>an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is launched prior to <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> execution</p></li>
<li><p>an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow</p></li>
</ul>
</div>
<p><strong>Define a TorchScript Script</strong></p>
<p>For the example, we create the Python script <cite>torchscript.py</cite>. The file contains multiple
simple torch function shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">negate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">neg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">positive</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Attach the TorchScript Script to a SmartSim Ensemble</strong></p>
<p>Assuming an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists, we add a TorchScript script using
the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> function and specify the script path to the parameter <cite>script_path</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a Ensemble object</span>
<span class="linenos">2</span><span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">smartsim_model.add_script</span></code> code snippet, we offer the following arguments:</p>
<ul class="simple">
<li><p><cite>name</cite> (“example_script”): Reference name for the script inside of the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>script_path</cite> (“path/to/torchscript.py”): Path to the script file.</p></li>
<li><p><cite>device</cite> (“GPU”): device for script execution.</p></li>
<li><p><cite>devices_per_node</cite> (2): Use two GPUs per node.</p></li>
<li><p><cite>first_device</cite> (0): Start with 0 index GPU.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calling <cite>exp.start(ensemble_instance)</cite> prior to instantiation of an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> will result in
a failed attempt to load the ML model to a non-existent <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</div>
<p>When <cite>ensemble_instance</cite> is started via <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code>, the TorchScript will be loaded from file to the
<code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> that is launched prior to the start of <cite>ensemble_instance</cite>.</p>
</section>
</section>
<section id="define-torchscripts-as-raw-string">
<span id="ts-raw-string-ensemble"></span><h4>Define TorchScripts as Raw String<a class="headerlink" href="#define-torchscripts-as-raw-string" title="Permalink to this heading">#</a></h4>
<p>Users can upload TorchScript functions from string to send to a colocated or
standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. This feature is supported by the
<code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> function’s <cite>script</cite> parameter.</p>
<p>When specifying a TorchScript using <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code>, the
following arguments are offered:</p>
<ul class="simple">
<li><p><cite>name</cite> (str): Reference name for the script inside of the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p></li>
<li><p><cite>script</cite> (t.Optional[str] = None): String of function code (e.g. TorchScript code string).</p></li>
<li><p><cite>script_path</cite> (t.Optional[str] = None): path to TorchScript code.</p></li>
<li><p><cite>device</cite> (t.Literal[“CPU”, “GPU”] = “CPU”): device for script execution, defaults to “CPU”.</p></li>
<li><p><cite>devices_per_node</cite> (int = 1): The number of GPU devices available on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
<li><p><cite>first_device</cite> (int = 0): The first GPU device to use on the host. This parameter only applies to GPU devices and will be ignored if device is specified as CPU.</p></li>
</ul>
<section id="example-load-a-torchscript-from-string">
<h5>Example: Load a TorchScript From String<a class="headerlink" href="#example-load-a-torchscript-from-string" title="Permalink to this heading">#</a></h5>
<p>This example walks through the steps of instructing SmartSim to load a TorchScript function
from string to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> before the execution of the associated <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.
The source code example is available in the dropdown below for convenient execution and customization.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="c1"># Initialize the Experiment and set the launcher to auto</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;path/to/executable/simulation&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a Model object</span>
<span class="n">ensemble_instance</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;ensemble_name&quot;</span><span class="p">,</span> <span class="n">ensemble_settings</span><span class="p">)</span>

<span class="c1"># TorchScript string</span>
<span class="n">torch_script_str</span> <span class="o">=</span> <span class="s2">&quot;def negate(x):</span><span class="se">\n\t</span><span class="s2">return torch.neg(x)</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="c1"># Attach TorchScript to Ensemble</span>
<span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_script</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_script&quot;</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="n">torch_script_str</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example assumes:</p>
<ul class="simple">
<li><p>an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> is launched prior to <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> execution</p></li>
<li><p>an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> workflow</p></li>
</ul>
</div>
<p><strong>Define a String TorchScript</strong></p>
<p>Define the TorchScript code as a variable in the Python driver script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># TorchScript string</span>
<span class="linenos">2</span><span class="n">torch_script_str</span> <span class="o">=</span> <span class="s2">&quot;def negate(x):</span><span class="se">\n\t</span><span class="s2">return torch.neg(x)</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><strong>Attach the TorchScript Function to a SmartSim Ensemble</strong></p>
<p>Assuming an initialized <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble_instance</cite> exists, we add a TorchScript using
the <code class="docutils literal notranslate"><span class="pre">Ensemble.add_script</span></code> function and specify the variable <cite>torch_script_str</cite> to the parameter
<cite>script</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Attach TorchScript to Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble_instance</span><span class="o">.</span><span class="n">add_script</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;example_script&quot;</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="n">torch_script_str</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">devices_per_node</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">first_device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">ensemble_instance.add_script</span></code> code snippet, we offer the following arguments:</p>
<ul class="simple">
<li><p><cite>name</cite> (“example_script”): key to store script under.</p></li>
<li><p><cite>script</cite> (torch_script_str): TorchScript code.</p></li>
<li><p><cite>device</cite> (“GPU”): device for script execution.</p></li>
<li><p><cite>devices_per_node</cite> (2): Use two GPUs per node.</p></li>
<li><p><cite>first_device</cite> (0): Start with 0 index GPU.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Calling <cite>exp.start(ensemble_instance)</cite> prior to instantiation of an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> will result in
a failed attempt to load the ML model to a non-existent <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.</p>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> is started via <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code>, the TorchScript will be loaded to the
<code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> that is launched prior to the start of the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>.</p>
</section>
</section>
</section>
</section>
<section id="data-collision-prevention">
<span id="prefix-ensemble"></span><h2>Data Collision Prevention<a class="headerlink" href="#data-collision-prevention" title="Permalink to this heading">#</a></h2>
<section id="id6">
<h3>Overview<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>When multiple <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members use the same code to send and access their respective data
in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, key overlapping can occur, leading to inadvertent data access
between <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. To address this, SmartSim supports key prefixing
through <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code> which enables key prefixing for all
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. For example, during an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> simulation with prefixing enabled, SmartSim will add
the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member <cite>name</cite> as a prefix to the keys sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.
Enabling key prefixing eliminates issues related to key overlapping, allowing <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
members to use the same code without issue.</p>
<p>The key components of SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> prefixing functionality include:</p>
<ol class="arabic simple">
<li><p><strong>Sending Data to the Orchestrator</strong>: Users can send data to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>
with the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member name prepended to the data name by utilizing SmartSim <a class="reference internal" href="#model-prefix-func-ensemble"><span class="std std-ref">Ensemble functions</span></a>.</p></li>
<li><p><strong>Retrieving Data From the Orchestrator</strong>: Users can instruct a <code class="docutils literal notranslate"><span class="pre">Client</span></code> to prepend a
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member name to a key during data retrieval, polling, or check for existence on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>
through SmartRedis <a class="reference internal" href="model.html#client-prefix-func"><span class="std std-ref">Client functions</span></a>. However, entity interaction
must be registered using <a class="reference internal" href="#model-prefix-func-ensemble"><span class="std std-ref">Ensemble</span></a> or <a class="reference internal" href="model.html#model-prefix-func"><span class="std std-ref">Model</span></a> functions.</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For information on prefixing <code class="docutils literal notranslate"><span class="pre">Client</span></code> functions, visit the <a class="reference internal" href="model.html#client-prefix-func"><span class="std std-ref">Client functions</span></a> page of the <code class="docutils literal notranslate"><span class="pre">Model</span></code>
documentation.</p>
</div>
<p>For example, assume you have an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> that was initialized using the <a class="reference internal" href="#replicas-init"><span class="std std-ref">replicas</span></a> creation strategy.
Two identical <code class="docutils literal notranslate"><span class="pre">Model</span></code> were created named <cite>ensemble_0</cite> and <cite>ensemble_1</cite> that use the same executable application
within an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> named <cite>ensemble</cite>. In the application code you use the function <code class="docutils literal notranslate"><span class="pre">Client.put_tensor(&quot;tensor_0&quot;,</span> <span class="pre">data)</span></code>.
Without key prefixing enabled, the slower member will overwrite the data from the faster simulation.
With <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> key prefixing turned on, <cite>ensemble_0</cite> and <cite>ensemble_1</cite> can access
their tensor <cite>“tensor_0”</cite> by name without overwriting or accessing the other <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s <cite>“tensor_0”</cite> tensor.
In this scenario, the two tensors placed in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> are named <cite>ensemble_0.tensor_0</cite> and <cite>ensemble_1.tensor_0</cite>.</p>
<section id="ensemble-functions">
<span id="model-prefix-func-ensemble"></span><h4>Ensemble Functions<a class="headerlink" href="#ensemble-functions" title="Permalink to this heading">#</a></h4>
<p>An <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> object supports two prefixing functions: <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code> and
<code class="docutils literal notranslate"><span class="pre">Ensemble.register_incoming_entity</span></code>. For more information on each function, reference the
<a class="reference internal" href="api/smartsim_api.html#ensemble-api"><span class="std std-ref">Ensemble API docs</span></a>.</p>
<p>To enable prefixing on a <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>, users must use the <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code>
function in the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script. This function activates prefixing for tensors,
<code class="docutils literal notranslate"><span class="pre">Datasets</span></code>, and lists sent to an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> for all <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. This function
also enables access to prefixing <code class="docutils literal notranslate"><span class="pre">Client</span></code> functions within the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. This excludes
the <code class="docutils literal notranslate"><span class="pre">Client.set_data_source</span></code> function, where <code class="docutils literal notranslate"><span class="pre">enable_key_prefixing</span></code> is not require for access.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ML model and script prefixing is not automatically enabled through <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code>.
Prefixing must be enabled within the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by calling the <code class="docutils literal notranslate"><span class="pre">use_model_ensemble_prefix</span></code> method
on the <code class="docutils literal notranslate"><span class="pre">Client</span></code> embedded within the member application.</p>
</div>
<p>Users can enable the SmartRedis <code class="docutils literal notranslate"><span class="pre">Client</span></code> to interact with prefixed data, ML models and TorchScripts
using the <code class="docutils literal notranslate"><span class="pre">Client.set_data_source</span></code>. However, for SmartSim to recognize the producer entity name
passed to the function within an application, the producer entity must be registered on the consumer
entity using <code class="docutils literal notranslate"><span class="pre">Ensemble.register_incoming_entity</span></code>.</p>
<p>If a consumer <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member requests data sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> by other <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members, the producer members must be
registered on consumer member. To access <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members, SmartSim offers the attribute <code class="docutils literal notranslate"><span class="pre">Ensemble.models</span></code> that returns
a list of <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. Below we demonstrate registering producer members on a consumer member:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># list of producer Ensemble members</span>
<span class="n">list_of_ensemble_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;producer_0&quot;</span><span class="p">,</span> <span class="s2">&quot;producer_1&quot;</span><span class="p">,</span> <span class="s2">&quot;producer_2&quot;</span><span class="p">]</span>

<span class="c1"># Grab the consumer Ensemble member</span>
<span class="n">ensemble_member</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;producer_3&quot;</span><span class="p">)</span>
<span class="c1"># Register the producer members on the consumer member</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">list_of_ensemble_names</span><span class="p">:</span>
    <span class="n">ensemble_member</span><span class="o">.</span><span class="n">register_incoming_entity</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
<p>For examples demonstrating how to retrieve data within the entity application that produced
the data, visit the <code class="docutils literal notranslate"><span class="pre">Model</span></code> <a class="reference internal" href="model.html#copy-rename-del-prefix"><span class="std std-ref">Copy/Rename/Delete Operations</span></a> subsection.</p>
</section>
</section>
<section id="example-ensemble-key-prefixing">
<h3>Example: Ensemble Key Prefixing<a class="headerlink" href="#example-ensemble-key-prefixing" title="Permalink to this heading">#</a></h3>
<p>In this example, we create an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> comprised of two <code class="docutils literal notranslate"><span class="pre">Model</span></code>’s that use identical code
to send data to a standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. To prevent key collisions and ensure data
integrity, we enable key prefixing on the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> which automatically
appends the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member <cite>name</cite> to the data sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. After the
<code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> completes, we launch a consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code> within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script
to demonstrate accessing prefixed data sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> by <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members.</p>
<p>This example consists of <strong>three</strong> Python scripts:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#app-prod-prefix-ensemble"><span class="std std-ref">Application Producer Script</span></a>: This script is encapsulated
in a SmartSim <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script. Prefixing is enabled
on the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>. The producer script puts NumPy tensors on an <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>
launched in the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script. The <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> creates two
identical <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. The producer script is executed
in both <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members to send two prefixed tensors to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>.
The source code example is available in the dropdown below for convenient customization.</p></li>
</ol>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Application Producer Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartredis</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Initialize a Client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create NumPy array</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="c1"># Use SmartRedis Client to place tensor in standalone Orchestrator</span>
<span class="n">client</span><span class="o">.</span><span class="n">put_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><ol class="arabic simple">
<li><p><a class="reference internal" href="#app-con-prefix-ensemble"><span class="std std-ref">Application Consumer Script</span></a>: This script is encapsulated
within a SmartSim <code class="docutils literal notranslate"><span class="pre">Model</span></code> in the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script. The script requests the
prefixed tensors placed by the producer script. The source code example is available in
the dropdown below for convenient customization.</p></li>
</ol>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Application Consumer Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartredis</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">LLInfo</span>

<span class="c1"># Initialize a Client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Set the data source</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_data_source</span><span class="p">(</span><span class="s2">&quot;producer_0&quot;</span><span class="p">)</span>
<span class="c1"># Check if the tensor exists</span>
<span class="n">tensor_1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">poll_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Set the data source</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_data_source</span><span class="p">(</span><span class="s2">&quot;producer_1&quot;</span><span class="p">)</span>
<span class="c1"># Check if the tensor exists</span>
<span class="n">tensor_2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">poll_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">LLInfo</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;producer_0.tensor was found: </span><span class="si">{</span><span class="n">tensor_1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">LLInfo</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;producer_1.tensor was found: </span><span class="si">{</span><span class="n">tensor_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><ol class="arabic simple">
<li><p><a class="reference internal" href="#exp-prefix-ensemble"><span class="std std-ref">Experiment Driver Script</span></a>: The driver script launches the
<code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>, the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> (which sends prefixed keys to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>),
and the <code class="docutils literal notranslate"><span class="pre">Model</span></code> (which requests prefixed keys from the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>). The
<code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script is the centralized spot that controls the workflow.
The source code example is available in the dropdown below for convenient execution and
customization.</p></li>
</ol>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Experiment Driver Script Source Code<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">smartsim.log</span> <span class="kn">import</span> <span class="n">get_logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;Experiment Log&quot;</span><span class="p">)</span>
<span class="c1"># Initialize the Experiment</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a standalone Orchestrator</span>
<span class="n">standalone_orch</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_database</span><span class="p">(</span><span class="n">db_nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Initialize a RunSettings object for Ensemble</span>
<span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;/path/to/executable_producer_simulation&quot;</span><span class="p">)</span>

<span class="c1"># Initialize Ensemble</span>
<span class="n">producer_ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;producer&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">ensemble_settings</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Enable key prefixing for Ensemble members</span>
<span class="n">producer_ensemble</span><span class="o">.</span><span class="n">enable_key_prefixing</span><span class="p">()</span>

<span class="c1"># Initialize a RunSettings object for Model</span>
<span class="n">model_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;/path/to/executable_consumer_simulation&quot;</span><span class="p">)</span>
<span class="c1"># Initialize Model</span>
<span class="n">consumer_model</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="s2">&quot;consumer&quot;</span><span class="p">,</span> <span class="n">model_settings</span><span class="p">)</span>

<span class="c1"># Generate SmartSim entity folder tree</span>
<span class="n">exp</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">,</span> <span class="n">producer_ensemble</span><span class="p">,</span> <span class="n">consumer_model</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Launch Orchestrator</span>
<span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Launch Ensemble</span>
<span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">producer_ensemble</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Register Ensemble members on consumer Model</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">producer_ensemble</span><span class="p">:</span>
    <span class="n">consumer_model</span><span class="o">.</span><span class="n">register_incoming_entity</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Launch consumer Model</span>
<span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">consumer_model</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Clobber Orchestrator</span>
<span class="n">exp</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details><section id="the-application-producer-script">
<span id="app-prod-prefix-ensemble"></span><h4>The Application Producer Script<a class="headerlink" href="#the-application-producer-script" title="Permalink to this heading">#</a></h4>
<p>In the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script, we instruct SmartSim to create an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> comprised of
two duplicate members that execute this producer script. In the producer script, a SmartRedis <code class="docutils literal notranslate"><span class="pre">Client</span></code> sends a
tensor to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. Since the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members are identical and therefore use the same
application code, two tensors are sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. Without prefixing enabled on the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
the keys can be overwritten. To prevent this, we enable key prefixing on the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> in the driver script
via <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code>. When the producer script is executed by each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member, a
tensor is sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> with the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member <cite>name</cite> prepended to the tensor <cite>name</cite>.</p>
<p>Here we provide the producer script that is applied to the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">smartredis</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Initialize a Client</span>
<span class="linenos"> 5</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># Create NumPy array</span>
<span class="linenos"> 8</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="linenos"> 9</span><span class="c1"># Use SmartRedis Client to place tensor in standalone Orchestrator</span>
<span class="linenos">10</span><span class="n">client</span><span class="o">.</span><span class="n">put_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<p>After the completion of <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members <cite>producer_0</cite> and <cite>producer_1</cite>, the contents of the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;producer_0.tensor&quot;</span>
<span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="s2">&quot;producer_1.tensor&quot;</span>
</pre></div>
</div>
</section>
<section id="the-application-consumer-script">
<span id="app-con-prefix-ensemble"></span><h4>The Application Consumer Script<a class="headerlink" href="#the-application-consumer-script" title="Permalink to this heading">#</a></h4>
<p>In the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script, we initialize a consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code> that encapsulates
the consumer application to request the tensors produced from the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>. To do
so, we use SmartRedis key prefixing functionality to instruct the SmartRedis <code class="docutils literal notranslate"><span class="pre">Client</span></code>
to append the name of an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member to the key <cite>name</cite>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information on <code class="docutils literal notranslate"><span class="pre">Client</span></code> prefixing functions, visit the <a class="reference internal" href="model.html#client-prefix-func"><span class="std std-ref">Client functions</span></a>
subsection of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> documentation.</p>
</div>
<p>To begin, specify the imports and initialize a SmartRedis <code class="docutils literal notranslate"><span class="pre">Client</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">smartredis</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">LLInfo</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># Initialize a Client</span>
<span class="linenos">4</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To retrieve the tensor from the first <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member named <cite>producer_0</cite>, use
<code class="docutils literal notranslate"><span class="pre">Client.set_data_source</span></code>. Specify the name of the first <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member
as an argument to the function. This instructs SmartSim to append the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member name to the data
search on the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. When <code class="docutils literal notranslate"><span class="pre">Client.poll_tensor</span></code> is executed,
the SmartRedis <cite>client</cite> will poll for key, <cite>producer_0.tensor</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Set the data source</span>
<span class="linenos">2</span><span class="n">client</span><span class="o">.</span><span class="n">set_data_source</span><span class="p">(</span><span class="s2">&quot;producer_0&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="c1"># Check if the tensor exists</span>
<span class="linenos">4</span><span class="n">tensor_1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">poll_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Follow the same steps above, however, change the data source <cite>name</cite> to the <cite>name</cite>
of the second <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member (<cite>producer_1</cite>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Set the data source</span>
<span class="linenos">2</span><span class="n">client</span><span class="o">.</span><span class="n">set_data_source</span><span class="p">(</span><span class="s2">&quot;producer_1&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="c1"># Check if the tensor exists</span>
<span class="linenos">4</span><span class="n">tensor_2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">poll_tensor</span><span class="p">(</span><span class="s2">&quot;tensor&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>We print the boolean return to verify that the tensors were found:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">client</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">LLInfo</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;producer_0.tensor was found: </span><span class="si">{</span><span class="n">tensor_1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">client</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">LLInfo</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;producer_1.tensor was found: </span><span class="si">{</span><span class="n">tensor_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script is executed, the following output will appear in <cite>consumer.out</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Default@11-46-05:producer_0.tensor<span class="w"> </span>was<span class="w"> </span>found:<span class="w"> </span>True
Default@11-46-05:producer_1.tensor<span class="w"> </span>was<span class="w"> </span>found:<span class="w"> </span>True
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For SmartSim to recognize the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member names as a valid data source
to <code class="docutils literal notranslate"><span class="pre">Client.set_data_source</span></code>, you must register each <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member
on the consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code> in the driver script via <code class="docutils literal notranslate"><span class="pre">Model.register_incoming_entity</span></code>.
We demonstrate this in the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script section of the example.</p>
</div>
</section>
<section id="the-experiment-script">
<span id="exp-prefix-ensemble"></span><h4>The Experiment Script<a class="headerlink" href="#the-experiment-script" title="Permalink to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script manages all workflow components and utilizes the producer and consumer
application scripts. In the example, the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>:</p>
<ul class="simple">
<li><p>launches standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code></p></li>
<li><p>launches an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> via the replicas initialization strategy</p></li>
<li><p>launches a consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code></p></li>
<li><p>clobbers the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code></p></li>
</ul>
<p>To begin, add the necessary imports, initialize an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> instance and initialize the
standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">smartsim</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="linenos">2</span><span class="kn">from</span> <span class="nn">smartsim.log</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;Experiment Log&quot;</span><span class="p">)</span>
<span class="linenos">5</span><span class="c1"># Initialize the Experiment</span>
<span class="linenos">6</span><span class="n">exp</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="s2">&quot;getting-started&quot;</span><span class="p">,</span> <span class="n">launcher</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="c1"># Initialize a standalone Orchestrator</span>
<span class="linenos">9</span><span class="n">standalone_orch</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_database</span><span class="p">(</span><span class="n">db_nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>We are now setup to discuss key prefixing within the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> driver script.
To create an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> using the replicas strategy, begin by initializing a <code class="docutils literal notranslate"><span class="pre">RunSettings</span></code>
object to apply to all <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> members. Specify the path to the application
producer script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a RunSettings object for Ensemble</span>
<span class="linenos">2</span><span class="n">ensemble_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;/path/to/executable_producer_simulation&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, initialize an <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> by specifying <cite>ensemble_settings</cite> and the number of <code class="docutils literal notranslate"><span class="pre">Model</span></code> <cite>replicas</cite> to create:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize Ensemble</span>
<span class="linenos">2</span><span class="n">producer_ensemble</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_ensemble</span><span class="p">(</span><span class="s2">&quot;producer&quot;</span><span class="p">,</span> <span class="n">run_settings</span><span class="o">=</span><span class="n">ensemble_settings</span><span class="p">,</span> <span class="n">replicas</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Instruct SmartSim to prefix all tensors sent to the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> from the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> via <code class="docutils literal notranslate"><span class="pre">Ensemble.enable_key_prefixing</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Enable key prefixing for Ensemble members</span>
<span class="linenos">2</span><span class="n">producer_ensemble</span><span class="o">.</span><span class="n">enable_key_prefixing</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, initialize the consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code>. The consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code> application requests
the prefixed tensors produced by the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Initialize a RunSettings object for Model</span>
<span class="linenos">2</span><span class="n">model_settings</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_run_settings</span><span class="p">(</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;/path/to/executable_consumer_simulation&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="c1"># Initialize Model</span>
<span class="linenos">4</span><span class="n">consumer_model</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="s2">&quot;consumer&quot;</span><span class="p">,</span> <span class="n">model_settings</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, organize the SmartSim entity output files into a single <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> folder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Generate SmartSim entity folder tree</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">,</span> <span class="n">producer_ensemble</span><span class="p">,</span> <span class="n">consumer_model</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Launch the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Launch Orchestrator</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Launch the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Launch Ensemble</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">producer_ensemble</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Set <cite>block=True</cite> so that <code class="docutils literal notranslate"><span class="pre">Experiment.start</span></code> waits until the last <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member has finished before continuing.</p>
<p>The consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code> application script uses <code class="docutils literal notranslate"><span class="pre">Client.set_data_source</span></code> which
accepts the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code> member names when searching for prefixed
keys in the <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>. In order for SmartSim to recognize the <code class="docutils literal notranslate"><span class="pre">Ensemble</span></code>
member names as a valid data source in the consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code>, we must register
the entity interaction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Register Ensemble members on consumer Model</span>
<span class="linenos">2</span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">producer_ensemble</span><span class="p">:</span>
<span class="linenos">3</span>    <span class="n">consumer_model</span><span class="o">.</span><span class="n">register_incoming_entity</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>Launch the consumer <code class="docutils literal notranslate"><span class="pre">Model</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Launch consumer Model</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">consumer_model</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To finish, tear down the standalone <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Clobber Orchestrator</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">standalone_orch</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="model.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model</p>
      </div>
    </a>
    <a class="right-next"
       href="orchestrator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Orchestrator</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization">Initialization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-expansion">Parameter Expansion</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replicas">Replicas</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manually-append">Manually Append</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#files">Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ml-models-and-scripts">ML Models and Scripts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ai-models">AI Models</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-attach-an-in-memory-ml-model">Example: Attach an In-Memory ML Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-attach-an-ml-model-from-file">Example: Attach an ML Model From File</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torchscripts">TorchScripts</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-an-in-memory-torchscript">Attach an In-Memory TorchScript</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-load-a-in-memory-torchscript-function">Example: Load a In-Memory TorchScript Function</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-a-torchscript-from-file">Attach a TorchScript From File</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-loading-a-torchscript-from-file">Example: Loading a TorchScript From File</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-torchscripts-as-raw-string">Define TorchScripts as Raw String</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#example-load-a-torchscript-from-string">Example: Load a TorchScript From String</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-collision-prevention">Data Collision Prevention</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ensemble-functions">Ensemble Functions</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-ensemble-key-prefixing">Example: Ensemble Key Prefixing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-application-producer-script">The Application Producer Script</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-application-consumer-script">The Application Consumer Script</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-experiment-script">The Experiment Script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cray Labs
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021-2024, Hewlett Packard Enterprise.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  Questions? You can contact <a href="mailto:craylabs@hpe.com">contact us</a> or <a href="https://join.slack.com/t/craylabs/shared_invite/zt-nw3ag5z5-5PS4tIXBfufu1bIvvr71UA">join us on Slack!</a>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>